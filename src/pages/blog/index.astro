---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const category = Astro.url.searchParams.get('category');

const allPosts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

let filteredPosts = allPosts;
if (category === 'technical' || category === 'essay') {
  filteredPosts = allPosts.filter(post => post.data.category === category);
}

const sortedPosts = filteredPosts.sort((a, b) => 
  b.data.pubDatetime.getTime() - a.data.pubDatetime.getTime()
);

const title = category === 'technical' ? 'Technical Writing' : category === 'essay' ? 'Essays' : 'Writing';
---

<Layout title={title}>
	<main class="max-w-xl mx-auto px-6 py-16 md:py-24">
		
		<header class="mb-12">
			<a href="/" class="text-[15px] text-neutral-600 hover:text-orange-600 mb-4 inline-block">‚Üê Back</a>
			<h1 class="text-2xl font-normal text-neutral-900">{title}</h1>
			{!category && (
				<div class="flex gap-4 text-[15px] mt-4">
					<a href="/blog?category=technical" class="text-orange-600 hover:text-orange-700 underline decoration-1 underline-offset-2">Technical</a>
					<a href="/blog?category=essay" class="text-orange-600 hover:text-orange-700 underline decoration-1 underline-offset-2">Essays</a>
				</div>
			)}
		</header>

		<div class="space-y-8">
			{sortedPosts.map((post) => (
				<a href={`/blog/${post.data.postSlug}`} class="block group">
					<div class="flex items-baseline justify-between mb-1">
						<h3 class="font-normal text-neutral-900 group-hover:text-orange-600">{post.data.title}</h3>
						<span class="text-sm text-neutral-400 whitespace-nowrap ml-4">
							{post.data.pubDatetime.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
						</span>
					</div>
					<p class="text-neutral-700 text-[15px] leading-relaxed">{post.data.description}</p>
				</a>
			))}
		</div>

	</main>
</Layout>
